---
import BlogEntrySmall from 'src/components/BlogEntrySmall.vue'
import MainLayout from 'src/layouts/main.astro'
import { getCollection } from 'astro:content'
import type { BlogEntry } from 'src/types/blog'

const isDev = process.env.NODE_ENV === 'development'
const currentDate = new Date()
const blogEntries = await getCollection('blog').then(
	(entry) =>
		entry
			.filter((item) => item.data.draft ? isDev : new Date(item.data.publishDate) <= currentDate)
			.map((entry) => ({
				...entry,
				data: {
					...entry.data,
					publishDate: entry.data.publishDate
						.toISOString()
						.slice(0, 10) as string,
				},
			})) as BlogEntry[],
)
---

<MainLayout title="Alper's Blog">
	{blogEntries.map((blog) => <BlogEntrySmall entry={blog} />)}
</MainLayout>
